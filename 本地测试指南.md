# 🧪 MiniGamesHub 本地测试完整指南

## 📋 测试前准备

### 1. 确认配置文件

首先确保你的 `config.js` 文件已经配置了正确的 Supabase 连接信息：

```javascript
const SUPABASE_CONFIG = {
    url: 'https://wcxdjyeiajswwvjudscl.supabase.co',  // ✅ 已配置
    anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' // ✅ 已配置
};
```

### 2. 检查数据库连接

确保你的 Supabase 数据库已经导入了游戏数据。在 Supabase SQL Editor 中运行：

```sql
-- 检查游戏数据
SELECT COUNT(*) as total_games FROM gm_games WHERE published = '1';
-- 应该显示 26,564 条记录

-- 检查分类数据  
SELECT COUNT(*) as total_categories FROM gm_categories;
-- 应该显示 20+ 个分类
```

### 3. 清理浏览器缓存与 Service Worker

旧版 `sw.js` 会拦截跨域游戏请求，导致 iframe 无法加载。为避免缓存的旧逻辑影响测试，请在开始测试前执行以下操作：

1. 打开浏览器开发者工具 → `Application` → `Service Workers`
2. 勾选 **Update on reload**，点击 **Unregister** 旧的 Service Worker
3. 在 `Application` → `Storage` 中点击 **Clear site data**
4. 刷新页面后确认新的 Service Worker 已注册（版本 `minigameshub-games-v1.0.0` 会重新写入缓存）

## 🚀 启动本地服务器

### 方法一：使用 Python（推荐，最简单）

```bash
# Python 3.x
cd /Users/zhaoxiqiang/Documents/web/minigameshub
python3 -m http.server 8000

# 或者 Python 2.x
python -m SimpleHTTPServer 8000
```

✅ **优点**：Mac 系统自带，无需安装额外软件

### 方法二：使用 Node.js HTTP Server

```bash
# 首先安装 http-server（只需安装一次）
npm install -g http-server

# 启动服务器
cd /Users/zhaoxiqiang/Documents/web/minigameshub
http-server -p 8000 -c-1
```

✅ **优点**：功能更强大，支持更多选项

### 方法三：使用 Live Server（VS Code）

如果你使用 VS Code 编辑器：

1. 安装 "Live Server" 扩展
2. 右键点击 `index.html`
3. 选择 "Open with Live Server"
4. 自动在浏览器中打开，支持热重载

✅ **优点**：自动刷新，开发体验最佳

### 方法四：使用 PHP

```bash
cd /Users/zhaoxiqiang/Documents/web/minigameshub
php -S localhost:8000
```

## 🌐 访问本地网站

启动服务器后，在浏览器中访问：

```
http://localhost:8000
```

## ✅ 功能测试清单

### 1. 首页功能测试

- [ ] **页面加载**
  - 打开 http://localhost:8000
  - 确认页面正常显示，无报错
  
- [ ] **游戏列表**
  - 确认游戏卡片正确显示
  - 检查游戏图片是否加载
  - 验证游戏标题和描述

- [ ] **分类导航**
  - 点击顶部分类菜单
  - 确认各分类页面能正常切换
  - 验证分类下的游戏显示正确

### 2. 导航与专题页测试

- [ ] **顶部导航跳转**
  - 依次点击 `Featured / New Games / Popular`，确认会打开 `collection.html` 对应的专题页，不再出现 404
  - 检查新页面顶部文案、面包屑与游戏数量是否与专题匹配
- [ ] **分类下拉菜单**
  - 在导航栏 `Categories` 下拉中选择任意分类
  - 确认跳转到 `collection.html?category=slug` 并加载对应分类游戏列表
- [ ] **更多内容**
  - 在专题页中体验排序、加载更多按钮，确保 `Play Now` 打开模态框可以直接试玩

### 3. 搜索功能测试

- [ ] **搜索框**
  - 输入游戏名称（如 "racing"）
  - 确认搜索结果实时显示
  - 验证搜索结果的准确性

- [ ] **搜索过滤**
  - 测试按分类过滤
  - 测试按评分排序
  - 验证分页功能

### 4. 游戏播放测试

- [ ] **游戏页面**
  - 点击任意游戏卡片
  - 确认游戏详情页正常打开
  - 检查游戏信息显示完整

- [ ] **游戏加载**
  - 点击 "Play Game" 按钮
  - 确认游戏 iframe 正常加载（Network 面板中可见来自 `html5.gamemonetize.com` 的请求并返回 200 / opaque）
  - 测试全屏功能

- [ ] **游戏交互**
  - 验证游戏能正常操作
  - 测试声音是否正常
  - 检查游戏性能

### 5. 响应式设计测试

- [ ] **桌面版** (1920x1080)
  - 全屏显示效果
  - 布局是否美观

- [ ] **平板版** (768x1024)
  - iPad 竖屏/横屏
  - 触摸操作是否流畅

- [ ] **手机版** (375x667)
  - iPhone 显示效果
  - 菜单是否正常工作

**快速测试方法**：
1. 打开 Chrome 开发者工具（F12）
2. 点击设备模拟器图标
3. 选择不同设备预设

### 6. PWA 功能测试

- [ ] **安装提示**
  - Chrome 地址栏应显示安装图标
  - 点击后能安装为桌面应用

- [ ] **离线访问**
  - 安装 PWA 后断网
  - 确认已缓存页面仍可访问

- [ ] **Service Worker**
  - 开发者工具 > Application > Service Workers
  - 确认 sw.js 已注册并激活

### 7. 性能测试

- [ ] **加载速度**
  - 首页应在 3 秒内完全加载
  - 游戏列表应快速渲染

- [ ] **Lighthouse 测试**
  ```
  1. 打开 Chrome 开发者工具
  2. 切换到 Lighthouse 标签
  3. 点击 "Generate report"
  4. 目标分数：Performance > 90
  ```

### 8. 浏览器兼容性测试

测试以下浏览器：
- [ ] Chrome (最新版)
- [ ] Safari (Mac)
- [ ] Firefox
- [ ] Edge

### 9. SEO 配置检查

- [ ] `robots.txt` 应可访问且包含 `/collections/`、`/games/`、`/assets/` 的允许规则，并列出最新 `sitemap.xml`
- [ ] 执行 `node seo/sitemap-generator.js` 生成 `sitemap-pages.xml / sitemap-games.xml / sitemap-categories.xml / sitemap-images.xml`
- [ ] 在浏览器中打开 `http://localhost:8000/sitemap.xml`，确认索引指向上述子站点地图且状态 200
- [ ] 检查首页与专题页源码的 `<link rel="canonical">` 是否指向 `https://minigameshub.co/...` 的唯一 URL，避免查询参数版本
- [ ] 在 Collection 页面查看开发者工具 Elements，确认 `application/ld+json` 中输出 CollectionPage + BreadcrumbList 结构化数据

## 🔍 开发者工具调试

### 查看控制台日志

打开浏览器开发者工具（F12），在 Console 中查看：

```javascript
// 测试 Supabase 连接
console.log('Supabase Config:', window.MiniGamesHubConfig.getConfig('supabase'));

// 测试数据库查询
const { data, error } = await supabase
  .from('gm_games')
  .select('*')
  .limit(5);
console.log('Games:', data);

// 检查配置
console.log('Site Config:', window.MiniGamesHubConfig.getConfig('site'));
```

### 网络请求监控

1. 开发者工具 > Network 标签
2. 刷新页面
3. 查看所有请求是否成功（状态码 200）
4. 特别关注 Supabase API 请求

### 检查错误

1. Console 标签 - 查看 JavaScript 错误
2. Network 标签 - 查看失败的请求（红色）
3. Application > Storage - 检查本地存储

## ⚠️ 常见问题解决

### 问题 1：游戏列表为空

**症状**：页面加载但没有游戏显示

**解决方案**：

**方法一：使用专用测试页面（推荐）**
```bash
# 打开浏览器访问
http://localhost:8000/test-database-connection.html
```
这个页面提供了完整的数据库连接测试功能，包括：
- SDK 加载检查
- 配置验证
- 连接测试
- 数据查询测试

**方法二：在浏览器控制台手动测试**
```javascript
// 正确的测试方法 - 手动创建客户端
const testClient = window.supabase.createClient(
  'https://wcxdjyeiajswwvjudscl.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndjeGRqeWVpYWpzd3d2anVkc2NsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNjc2NTgsImV4cCI6MjA3Mjc0MzY1OH0.LlTC_KYcbsBi52c_LLdo-1WeHZYF0JThjqlxVoZNFZI'
);

const { data, error } = await testClient
  .from('gm_games')
  .select('*')
  .limit(5);
  
if (error) {
  console.error('数据库连接错误:', error);
} else {
  console.log('数据库连接成功，游戏数据:', data);
}
```

**方法三：使用已初始化的 GameDataManager**
```javascript
// 检查数据是否已加载
if (window.gameDataManager && window.gameDataManager.loaded) {
  console.log('✅ 数据已加载!');
  console.log('游戏数量:', window.gameDataManager.getAllGames().length);
  console.log('分类数量:', window.gameDataManager.getAllCategories().length);
} else {
  console.log('⏳ 数据正在加载中...');
}
```

### 问题 2：CORS 错误

**症状**：控制台显示 "Access-Control-Allow-Origin" 错误

**解决方案**：
1. 确保使用 `http://localhost:8000` 而不是 `file://`
2. 检查 Supabase Dashboard > Authentication > URL Configuration
3. 添加 `http://localhost:8000` 到允许的 URL 列表

### 问题 3：游戏无法加载

**症状**：点击游戏后 iframe 显示空白

**解决方案**：
1. 检查游戏 URL 是否有效
2. 某些游戏可能限制 localhost 访问
3. 尝试其他游戏测试

### 问题 4：Service Worker 错误

**症状**：PWA 功能不工作

**解决方案**：
```bash
# Service Worker 只在 HTTPS 或 localhost 下工作
# 确保使用 http://localhost:8000
# 不要使用 http://127.0.0.1:8000
```

## 📱 移动设备真机测试

### 在同一 WiFi 下测试

1. **获取本机 IP 地址**：
   ```bash
   # Mac 系统
   ifconfig | grep "inet " | grep -v 127.0.0.1
   # 找到类似 192.168.1.100 的地址
   ```

2. **启动服务器**：
   ```bash
   python3 -m http.server 8000 --bind 0.0.0.0
   ```

3. **手机访问**：
   - 确保手机和电脑在同一 WiFi
   - 手机浏览器访问：`http://192.168.1.100:8000`
   - 测试触摸操作和响应式布局

### 使用 ngrok 公网测试

1. **安装 ngrok**：
   ```bash
   brew install ngrok
   ```

2. **启动隧道**：
   ```bash
   ngrok http 8000
   ```

3. **获取公网地址**：
   - ngrok 会提供一个临时公网地址
   - 如：`https://abc123.ngrok.io`
   - 任何设备都可以访问此地址测试

## 🎯 测试报告模板

```markdown
## 测试报告 - [日期]

### 环境信息
- 操作系统：macOS [版本]
- 浏览器：Chrome [版本]
- 服务器：Python HTTP Server
- 数据库：Supabase (已连接)

### 测试结果
✅ 首页加载 - 通过
✅ 游戏列表显示 - 通过  
✅ 搜索功能 - 通过
⚠️ 游戏加载 - 部分游戏加载缓慢
✅ 响应式设计 - 通过
✅ PWA 安装 - 通过

### 发现的问题
1. [问题描述]
2. [问题描述]

### 性能指标
- 首页加载时间：2.3s
- Lighthouse 分数：92
- 游戏列表渲染：0.8s
```

## 💡 专业提示

1. **使用 Chrome DevTools**
   - Performance 标签分析性能瓶颈
   - Coverage 标签查看代码使用率
   - Rendering 标签检查重绘问题

2. **批量测试游戏**
   ```javascript
   // 在控制台运行，自动测试前10个游戏
   const games = document.querySelectorAll('.game-card');
   for(let i = 0; i < Math.min(10, games.length); i++) {
     setTimeout(() => {
       games[i].click();
       console.log(`Testing game ${i+1}`);
     }, i * 3000);
   }
   ```

3. **监控内存使用**
   - 开发者工具 > Memory
   - 定期检查内存泄漏
   - 特别注意游戏切换时的内存释放

## 🚦 准备上线检查

本地测试通过后，上线前确认：

- [ ] 所有功能测试通过
- [ ] 性能指标达标（Lighthouse > 90）
- [ ] 无控制台错误
- [ ] 移动端体验良好
- [ ] 数据库连接稳定
- [ ] 配置文件已更新为生产环境

---

**提示**：本地测试是确保网站质量的重要步骤。建议在每次更新后都进行完整测试，确保用户体验始终保持最佳状态！

如有任何问题，请参考 [部署指南](网站部署上线完整指导.md) 或查看 [README](README.md) 文档。
